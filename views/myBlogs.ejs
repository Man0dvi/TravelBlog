<!DOCTYPE html>
<html>
    <head>
        <%- include('common/head'); %>
    </head>
    <body>
        <%- include('common/nav'); %> 
        <div class="container">
            <div class="row">
                <div class="d-flex justify-content-between my-5">
                    <h1>
                        My Blogs
                    </h1>
                    <div class="form-group">
                        <select class="form-select" id="myBlogsCategory" onchange="getBlogs('category',this.value)">
                            <option value="choose">Choose a category</option>
                            <option value="hill">Hill Station</option>
                            <option value="beach">Beach</option>
                            <option value="domestic">Domestic</option>
                            <option value="international">International</option>
                        </select>
                      </div>
                </div>
            </div>
            <div id="previews" class="row">
            </div>
        </div>
    </body>
</html>
<script>
    getBlogs();
    function getBlogs(optionKey, optionValue) {
        const previewDiv = document.getElementById('previews');
        previewDiv.innerHTML = `
        <div class="w-50">
            <div class="progress  progress-striped active ">
            <div class="progress-bar progress-bar-striped indeterminate" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>`;
        let URL = 'http://localhost:3000/api/blogs';
        if(optionKey && optionValue!=='choose'){
            URL+='?'+optionKey+'='+optionValue
        }
        fetch(URL)
            .then(res => res.json())
            .then(function(response) {
            let innerHtml = '';
            previewDiv.innerHTML = '';
            response.forEach(async function(res) {
                // const meta = '<'+'%-'+" include('components/blogPreview') %"+'>';
                // const fn = ejs.compile(meta, {client: true})({
                //     blogMeta: JSON.stringify(res)
                // });
                // const t = fn();
                let transport = 
                    res.transport === 'Train' 
                        ? '<i class="fa-solid fa-train-subway"></i>' : 
                        res.transport === 'Car' 
                            ? '<i class="fa-solid fa-car"></i>' : 
                            '<i class="fa-solid fa-jet-fighter-up"></i>';
                let category = res.category === 'hill' ? '<i class="fa-solid fa-mountain"></i>' : '<i class="fa-solid fa-umbrella-beach"></i>' 
                let str = `
                <div class='col-md-3'>
                    <div class="card border-primary mb-3">
                        <figure class="card__thumbnail">
                            <img src="https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?ixlib=rb-1.2.1&q=85&fm=jpg&crop=entropy&cs=srgb&ixid=eyJhcHBfaWQiOjE0NTg5fQ">
                            <div class="card__title">
                                <div>
                                    ${res.blogTitle}
                                </div>
                                <div>
                                    â‚¹ ${res.budget}
                                </div>    
                                <div>
                                    ${transport} ${category}
                                </div>
                            </div>
                        </figure>
                    </div>
                </div>`
                innerHtml+=str;
            });
            previewDiv.innerHTML = innerHtml;
        });
    }
</script>